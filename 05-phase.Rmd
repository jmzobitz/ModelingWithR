# Phase Lines and Equilibrium Solutions {#phase-05}

In modeling with differential equations, we want to understand how a system develops both qualitatively and quantitatively.  Euler's method (and other associated numerical methods for solving differential equations) illustrate solution behavior numerically. One key thing about the qualitative analysis is we are interested in the *motion* or the "flow" of the solution at a given point.  Is the solution increasing, decreasing, or staying the same?

For this section we will discuss qualitative aspects of a differential equation. We are going to focus on differential equations in one variable. Section \@ref(coupled-06) will build your understanding of the same idea with coupled systems of equations. 

## Equilibrium solutions
A great place to start is where the rate of change for a differential equation is zero, or in other words there is _no_ flow.  Borrowing ideas from calculus, this occurs when the rate of change is zero.  We solve this by setting the left hand side of $\displaystyle \frac{dy}{dt}=f(y)$ equal to zero and solving for $y$ (or whatever dependent variable describes the problem).

```{example}
What are the equilibrium solutions to $\displaystyle \frac{dy}{dt}=- y$?
```

```{solution}
For this example we know that when the rate of change is zero, this means that $\displaystyle \frac{dy}{dt} = 0$, or when $0 = -y$. So $y=0$ is the equilibrium solution. 
```

The general solution to the differential equation $\displaystyle \frac{dy}{dt}=- y$ is when $y(t)=Ce^{-t}$, where $C$ is an arbitrary constant.  Figure \@ref(fig:exponential) plots different solution curves, with the equilibrium solution shown as a horizontal line:

```{r, label="exponential", echo=FALSE,fig.width=4,fig.height=3,fig.cap="Solution curves to $y'=-y$"}
t <- seq(0, 5, length.out = 50)
data.frame(time = t, s1 = exp(-t), s2 = 2 * exp(-t), s3 = -1 * exp(-t), s4 = -2 * exp(-t)) %>%
  gather(key = constant, value = soln, -time) %>%
  ggplot() +
  geom_line(aes(x = time, y = soln, color = constant), size = 2) +
  labs(x = "t", y = "y") +
  geom_hline(aes(yintercept = 0), linetype = "dashed") +
  scale_color_discrete(
    labels = c("C = 1", "C = 2", "C = -1", "C = -2"),
    name = "Solution curves"
  )
```


Notice that as $t$ increases, all solutions approach the equilibrium solution $y=0$ as $t$ no matter if the initial condition is positive or negative.  A second way that we can verify that solutions approach the equilibrium solution is by evaluate the following limit: $\displaystyle \lim_{t\rightarrow \infty} Ce^{-t} = 0$.
 
```{example}
What are the equilibrium solutions to $\displaystyle \frac{dN}{dt} = N \cdot(1-N)$?
```

```{solution}
In this case the equilibrium solutions occur when $N \cdot(1-N) = 0$, or when $N=0$ or $N=1$.

```
The generic solution to this differential equation is $$ \displaystyle N(t)= \frac{N_0}{N_0 +(1-N_0) e^{-t}}.$$ Figure \@ref(fig:logistic-soln) displays several different solution curves.

```{r, label="logistic-soln", echo=FALSE,fig.width=4,fig.cap="Solution curves for $N'=N(1-N)$",fig.height=3,fig.pos='H'}
t <- seq(0, 5, length.out = 50)
data.frame(time = t, s1 = 2 / (2 + (1 - 2) * exp(-t)), s2 = 1.5 / (1.5 + (1 - 1.5) * exp(-t)), s3 = 0.5 / (0.5 + (1 - 0.5) * exp(-t)), s4 = 0.25 / (0.25 + (1 - 0.25) * exp(-t)), s5 = 0.1 / (0.1 + (1 - 0.1) * exp(-t))) %>%
  gather(key = constant, value = soln, -time) %>%
  ggplot() +
  geom_line(aes(x = time, y = soln, color = constant), size = 2) +
  labs(x = "t", y = "N") +
  geom_hline(aes(yintercept = 0), linetype = "dashed") +
  geom_hline(aes(yintercept = 1), linetype = "dashed") +
  scale_color_discrete(
    labels = c("C = 2", "C = 1.5", "C = 0.5", "C = 0.25", "C = 0.1"),
    name = "Solution curves"
  )
```

&nbsp;

In Figure \@ref(fig:logistic-soln) notice how all the solutions tend towards $N=1$, but even solutions that start close to $N=0$ seem to move away from this equilibrium solution.  This example brings us to understanding classifying the *stability* of the equilibrium solutions.


## Phase lines for differential equations


While it is one thing to determine where the equilibrium solutions are, we are also interested in classifying the **stability** of the equilibrium solutions.  To do this investigate the behavior of the differential equation around the equilibrium solutions, using facts from calculus:

- If $\displaystyle \frac{dy}{dt}<0$, the solution $y(t)$ is decreasing.
- If $\displaystyle \frac{dy}{dt}>0$, the solution $y(t)$ is increasing.


Let's apply this logic to our differential equation $\displaystyle \frac{dy}{dt}=- y$.  We know that if $y=3$, $\displaystyle \frac{dy}{dt}=- 3 <0$, so we say the function is *decreasing* to $y=0$.  If  $y=-2$, $\displaystyle \frac{dy}{dt}=- (-2) = 2 >0$, so we say the function is *increasing* to $y=0$.  This can be represented neatly in the phase line diagram for Figure \@ref(fig:phaseline1):


```{r,label="phaseline1",echo=FALSE,fig.width=4,fig.height=3,fig.cap="Phase line to $y'=-y$."}
eq_soln <- data.frame(x = c(0), y = c(0), label = "y = 0")
data.frame(point = c(-2, 3), label = c("y' > 0", "y' < 0"), tendency = c("y increasing", "y decreasing")) %>%
  ggplot() +
  geom_text(aes(point, 0.5, label = label)) +
  geom_text(aes(point, -.5, label = tendency)) +
  geom_text(data = eq_soln, aes(x = x, y = -1.2, label = label)) +
  geom_hline(yintercept = 0) +
  geom_segment(data = eq_soln, aes(x = x, xend = x, y = -1, yend = 1)) +
  geom_point(data = eq_soln, aes(x = x, y = 0), size = 3, color = "red") +
  coord_cartesian(xlim = c(-5, 5), ylim = c(-4, 4)) +
  labs(
    x = NULL,
    y = NULL
  ) +
  theme_void()
# theme(axis.line.x = element_blank(),
#        axis.ticks = element_blank(),
#        axis.text = element_blank())
```

Because the solution is *increasing* to $y=0$ when $y <0$, and *decreasing* to $y=0$ when $y >0$, we say that the equilibrium solution is **stable**, which is also confirmed by the solutions we plotted above.

```{example,label="general-exponential"}
Classify the stability of the equilibrium solutions to $\displaystyle \frac{dy}{dt} = k \cdot y$, where $k$ is a parameter.
```

```{solution}
In this case the equilibrium solution is still $y=0$.  We will need to consider three different cases for the stability depending on the value of $k$ ($k>0$, $k<0$, and $k=0$):

- When $k<0$, the phase line will be similar Figure \@ref(fig:phaseline1).
- When $k>0$ the phase line will be is shown in the Figure \@ref(fig:phaseline2). We say in this case that the equilibrium solution is *unstable*, as all solutions flow away from the equilibrium.  Several different solutions are shown in Figure \@ref(fig:solncurve-1) 
- When $k=0$ we have the differential equation $\displaystyle \frac{dy}{dt}=0$, which has $y=C$ as a general solution.  For this special case the equilibrium solution is neither stable or unstable^[By all intents and purposes this is a different differential equation than $\displaystyle \frac{dy}{dt}=k\cdot y$; something peculiar is going on here - which we come back to when discuss bifurcations in Section \@ref(bifurcation-20).].


```
  
```{r,label="phaseline2",echo=FALSE,fig.width=4,fig.height=3, fig.cap="Phaseline for $y'=ky$, with $k>0$."}
eq_soln <- data.frame(x = c(0), y = c(0), label = "y = 0")
data.frame(point = c(-2, 3), label = c("y' < 0", "y' > 0"), tendency = c("y decreasing", "y increasing")) %>%
  ggplot() +
  geom_text(aes(point, 0.5, label = label)) +
  geom_text(aes(point, -.5, label = tendency)) +
  geom_text(data = eq_soln, aes(x = x, y = -1.2, label = label)) +
  geom_hline(yintercept = 0) +
  geom_segment(data = eq_soln, aes(x = x, xend = x, y = -1, yend = 1)) +
  geom_point(data = eq_soln, aes(x = x, y = 0), size = 3, color = "red") +
  coord_cartesian(xlim = c(-5, 5), ylim = c(-4, 4)) +
  labs(
    x = NULL,
    y = NULL
  ) +
  theme_void()
# theme(axis.line.x = element_blank(),
#        axis.ticks = element_blank(),
#        axis.text = element_blank())
```



```{r,label=solncurve-1, echo=FALSE,fig.width=4,fig.height=3,fig.cap="Solution curves for $y'=ky$, with $k>0$."}
t <- seq(0, 2, length.out = 50)
data.frame(time = t, s1 = exp(t), s2 = 2 * exp(t), s3 = -1 * exp(t), s4 = -2 * exp(t)) %>%
  gather(key = constant, value = soln, -time) %>%
  ggplot() +
  geom_line(aes(x = time, y = soln, color = constant), size = 2) +
  labs(x = "t", y = "y") +
  geom_hline(aes(yintercept = 0), linetype = "dashed") +
  scale_color_discrete(
    labels = c("C = 1", "C = 2", "C = -1", "C = -2"),
    name = "Solution curves"
  )
```



&nbsp;

```{example}
Let's investigate the phase line for the differential equation $\displaystyle \frac{dN}{dt} = N \cdot(1-N)$ and classify stability of the equilibrium solutions.
```

```{solution}
This differential equation has equilbrium solutions when $N(1-N)=0$, or $N=0$ or $N=1$.  We evaluate the stability of the solutions in the following table:

**Test point** | **Sign of $N'$**  | **Tendency of solution**
-------------| ------------- | -------------
    $N=-1$ | Negative | Decreasing
    $N=0$ |  Zero | Equilibrium solution
    $N=0.5$ | Positive | Increasing
    $N=1$ |  Zero | Equilibrium solution
    $N=2$ |  Negative | Decreasing

Notice how the selected test points in the first column are either the the _left_ or the _right_ of the equilbrium solution.  We can also represent the information in the table using a phase line diagram (Figure \@ref(fig:phaseline-N)), but in this case we need to include _two_ equilibrium solutions.

The table and Figure \@ref(fig:phaseline-N) confirms that $N$ is moving _away_ from $N=0$ (either decreasing when $N$ is less than 0 and increasing when $N$ is greater than 0) and moving _towards_ $N=1$ (either increasing when $N$ is between 0 and 1 and decreasing when $N$ is greater than one.

&nbsp;
These results suggest that equilibrium solution at $N=0$ to be *unstable* and at $N=1$ to be *stable*.


```  
  
  
  
  
  
```{r,label="phaseline-N",echo=FALSE,fig.width=4,fig.height=3,fig.pos='H',fig.cap="Phase line diagram for the differential equation $N'=N(1-N)$."}
eq_soln <- data.frame(x = c(0, 1), y = c(0, 1), label = c("N = 0", "N = 1"))
data.frame(point = c(-0.5, 0.5, 1.5), label = c("N' < 0", "N' > 0", "N' < 0"), tendency = c("N decreasing", "N increasing", "N decreasing")) %>%
  ggplot() +
  geom_text(aes(point, 0.5, label = label)) +
  geom_text(aes(point, -.5, label = tendency)) +
  geom_text(data = eq_soln, aes(x = x, y = -1.2, label = label)) +
  geom_hline(yintercept = 0) +
  geom_segment(data = eq_soln, aes(x = x, xend = x, y = -1, yend = 1)) +
  geom_point(data = eq_soln, aes(x = x, y = 0), size = 3, color = "red") +
  coord_cartesian(xlim = c(-1.5, 2), ylim = c(-4, 4)) +
  labs(
    x = NULL,
    y = NULL
  ) +
  theme_void()
# theme(axis.line.x = element_blank(),
#        axis.ticks = element_blank(),
#        axis.text = element_blank())
```



Other than writing the words in the phase line diagram, we also use arrows to signify increasing or decreasing in the solutions.

## A stability test for equilibrium solutions


Notice how when constructing the phase line diagram we relied on the behavior of solutions *around* the equilibrium solution to classify the stability.  As an alternative we can also use the point at the equilibrium solution itself.

To do this we are going to consider the general differential equation $\displaystyle \frac{dy}{dt}=f(y)$.  We are going to assume that we have an equilibrium solution at $y=y_{*}$.

We use local linearization to construct a locally linear approximation to $L(y)$ to $f(y)$ at $y=y_{*}$:

\begin{equation}
L(y) = f(y_{*}) + f'(y_{*}) \cdot (y-y_{*})  (\#eq:local-linear-1-05)
\end{equation}

Once we have the local linearization, there are two follow-on steps to simplify Equation \@ref(eq:local-linear-1-05). First, because we have an equilibrium solution, $f(y_{*}) =0$.  Second, Equation \@ref(eq:local-linear-1-05) can be written with a new variable $P$, defined by variable $P = y-y_{*}$. Then Equation \@ref(eq:local-linear-1-05) translates to

\begin{equation}
\frac{dP}{dt} = f'(y_{*}) \cdot P  (\#eq:local-linear)
\end{equation}

Does Equation \@ref(eq:local-linear) look familiar?  It should!  This equation is similar to the example where we classified the stability of $\displaystyle \frac{dy}{dt} = k \cdot y$ -- cool!  So let's use what we learned in Example \@ref(exm:general-exponential) above to classify the stability:

**Local linearization stability test for equilibrium solutions:** For a differential equation $\displaystyle \frac{dy}{dt} = f(y)$ with equilibrium solution $y_{*}$, we can classify the stability of the equilibrium solution through the following:

- If $f'(y_{*})’>0$ at an equilibrium solution, the equilibrium solution $y=y_{*}$ will be _unstable_.
- If $f'(y_{*}) <0$ at an equilibrium solution, the equilibrium solution $y=y_{*}$ will be _stable_.
- If $f'(y_{*}) = 0$, we cannot conclude anything about the stability of $y=y_{*}$.

```{example}
Apply local linearization to classify the stability of the equilibrium solutions of $\displaystyle \frac{dN}{dt} = N \cdot(1-N)$
```

```{solution}
The locally linear approximation is $L(N) = 1-2N$.  We have $L(0)=1>0$, so $N=0$ is unstable.  Similarly $L(1)=-1$, so $N=1$ is stable.
```

\newpage

## Exercises

```{exercise,label="eq-soln-ex"}
What are the equilibrium solutions to the following differential equations?

a. $\displaystyle \frac{dS}{dt} = 0.3 \cdot(10-S)$
b. $\displaystyle \frac{dP}{dt} = P \cdot(P-1)(P-2)$


Then classify the stability of the equilbrium solutions using the local linearization stability test.

```
&nbsp;
```{exercise}
Using your results from Exercise \@ref(exr:eq-soln-ex), construct a phase line for each of the differential equations and classify the stability of the equilibrium solutions.
```
&nbsp;


```{exercise}
A population grows according to the equation $\displaystyle \frac{dP}{dt} = \frac{P}{1+2P} - 0.2P$.

a. Determine the equilibrium solutions for this differential equation.
b. Classify the stability of the equilibrium solutions using the local linearization stability test.


```

&nbsp;


<!-- Based off LW pg 4 -->
```{exercise}
(Inspired by @logan_mathematical_2009) A cell with radius $r$ assimilates nutrients at a rate proportional to its surface area, but uses nutrients proportional to its volume, according to the following differential equation:
  $$ \frac{dr}{dt} =  4 \pi r^{2} -  \frac{4}{3} \pi r^{3}. $$
  

a. Determine the equilibrium solutions for this differential equation.
b. Construct a phase line for this differential equation to classify the stability of the equilibrium solutions.

  
  
```
&nbsp;

<!-- Thornley and Johnson -->
```{exercise}
(Inspired by @thornley_plant_1990) The Chanter equation of growth is the following, where $W$ is the weight of an object:
  \begin{equation}
\frac{dW}{dt} =  W(3-W)e^{-Dt},
\end{equation}

Use this differential equation to answer the following questions.


a. What happens to the rate of growth ($\displaystyle  \frac{dW}{dt}$) as $t$ grows large?
b. What are the equilibrium solutions to this model?  Are they stable or unstable?
\item Notice how the equilbrium solutions are the same as those for the logistic model.  Based on your previous work, do why would this model be a more realistic model of growth than the logistic model $\displaystyle  \frac{dW}{dt} = W(3-W)$?

```


&nbsp;


```{exercise}
Red blood cells are formed from stem cells in the bone marrow.  The red blood cell density $r$ satisfies an equation of the form

\begin{equation}
\frac{dr}{dt} = \frac{br}{1+r^{n}} - c r,
\end{equation}

where $n>1$ and $b>1$ and $c>0$.  Find all the equilibrium solutions $r_{*}$ to this differential equation. *Hint:* can you factor an $r$ from your equation first?
```
&nbsp;

 <!-- Van den Berg page 19 -->
```{exercise}
(Inspired by @berg_mathematical_2011) Organisms that live in a saline environment biochemically maintain the amount of salt in their blood stream.  An equation that represents the level of $S$ in the blood is the following:

$$ \frac{dS}{dt} = I + p \cdot (W - S) $$

Where the parameter $I$ represents the active uptake of salt, $p$ is the permeability of the skin, and $W$ is the salinity in the water.


a. First set $I=0$.  Determine the equilibrium solutions for this differential equation. Express your answer $S_{*}$ in terms of the parameters $p$, and $W$.
b. Next consider $I>0$.  Determine the equilibrium solutions for this differential equation. Express your answer $S_{*}$ in terms of the parameters $p$, $W$, and $I$.  Why should your new equilbrium solution be greater than the equilibrium solution from the previous problem?
c. Classify the stability of both equilibrium solutions using the local linearization stability test.


```
&nbsp;





<!-- LW exercise 5, pg 36 -->

```{exercise}
(Inspired by @logan_mathematical_2009) The immigration rate of bird species (species per time) from a mainland to an offshore island is $I_{m} \cdot (1-S/P)$, where $I_{m}$ is the maximum immigration rate, $P$ is the size of the source pool of species on the mainland, and $S$ is the number of species already occupying the island.  Further, the extinction rate is $E \cdot S / P$, where $E$ is the maximum extinction rate.  The growth rate of the number of species on the island is the immigration rate minus the extinction rate, given by the following differential equation:

\begin{equation} \frac{dS}{dt} = I_{m} \left(1-\frac{S}{P} \right) - \frac{ES}{P}
\end{equation}
  

a. Determine the equilibrium solutions $S_{*}$ for this differential equation. Expression your answer in terms of $I_{M}$, $P$, and $E$.
b. Classify the stability of the equilibrium solutions using the local linearization stability test.

  
```
&nbsp;

```{exercise}
A colony of bacteria growing in a nutrient-rich medium deplete the nutrient as they grow. As a result, the nutrient concentration $x(t)$ is steadily decreasing.  The equation describing this decrease is the following:
$$ \displaystyle \frac{dx}{dt} = - \mu \frac{x \cdot (\xi- x)}{\kappa + x}, $$

where $\mu$, $\kappa$, and $\xi$ are all parameters greater than zero.


a. Determine the equilibrium solutions $x_{*}$ for this differential equation.
b. Construct a phase line for this differential equation and classify the stability of the equilibrium solutions.



```
&nbsp;


```{exercise}
Can a solution curve cross an equilibrium solution of a differential equation?
```
&nbsp;
