<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>22.2 Computing ensemble averages | Exploring Modeling with Data and Differential Equations Using R</title>
  <meta name="description" content="A textbook used for MAT 369 at Augsburg University." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="22.2 Computing ensemble averages | Exploring Modeling with Data and Differential Equations Using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A textbook used for MAT 369 at Augsburg University." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="22.2 Computing ensemble averages | Exploring Modeling with Data and Differential Equations Using R" />
  
  <meta name="twitter:description" content="A textbook used for MAT 369 at Augsburg University." />
  

<meta name="author" content="John M. Zobitz" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ensemble-averages.html"/>
<link rel="next" href="doing-many-simulations-and-visualizing.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Modeling with Data and Differential Equations in R</strong><br>by John Zobitz</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="computational-code.html"><a href="computational-code.html"><i class="fa fa-check"></i>Computational code</a></li>
<li class="chapter" data-level="" data-path="questions-comments-issues.html"><a href="questions-comments-issues.html"><i class="fa fa-check"></i>Questions? Comments? Issues?</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a></li>
<li class="chapter" data-level="" data-path="copyright.html"><a href="copyright.html"><i class="fa fa-check"></i>Copyright</a></li>
</ul></li>
<li class="part"><span><b>I Models with Differential Equations</b></span></li>
<li class="chapter" data-level="1" data-path="intro-01.html"><a href="intro-01.html"><i class="fa fa-check"></i><b>1</b> Models of rates with data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="rates-of-change-in-the-world-a-model-is-born.html"><a href="rates-of-change-in-the-world-a-model-is-born.html"><i class="fa fa-check"></i><b>1.1</b> Rates of change in the world: a model is born</a></li>
<li class="chapter" data-level="1.2" data-path="modeling-in-context-the-spread-of-a-disease.html"><a href="modeling-in-context-the-spread-of-a-disease.html"><i class="fa fa-check"></i><b>1.2</b> Modeling in context: the spread of a disease</a></li>
<li class="chapter" data-level="1.3" data-path="model-solutions.html"><a href="model-solutions.html"><i class="fa fa-check"></i><b>1.3</b> Model solutions</a></li>
<li class="chapter" data-level="1.4" data-path="which-model-is-best.html"><a href="which-model-is-best.html"><i class="fa fa-check"></i><b>1.4</b> Which model is best?</a></li>
<li class="chapter" data-level="1.5" data-path="start-here.html"><a href="start-here.html"><i class="fa fa-check"></i><b>1.5</b> Start here</a></li>
<li class="chapter" data-level="1.6" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>1.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="r-intro-02.html"><a href="r-intro-02.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html"><i class="fa fa-check"></i><b>2.1</b> R and RStudio</a></li>
<li class="chapter" data-level="2.2" data-path="first-steps-getting-acquainted-with-r.html"><a href="first-steps-getting-acquainted-with-r.html"><i class="fa fa-check"></i><b>2.2</b> First steps: getting acquainted with R</a></li>
<li class="chapter" data-level="2.3" data-path="increasing-functionality-with-packages.html"><a href="increasing-functionality-with-packages.html"><i class="fa fa-check"></i><b>2.3</b> Increasing functionality with packages</a></li>
<li class="chapter" data-level="2.4" data-path="working-with-r-variables-data-frames-and-datasets.html"><a href="working-with-r-variables-data-frames-and-datasets.html"><i class="fa fa-check"></i><b>2.4</b> Working with R: variables, data frames, and datasets</a></li>
<li class="chapter" data-level="2.5" data-path="visualization-with-r.html"><a href="visualization-with-r.html"><i class="fa fa-check"></i><b>2.5</b> Visualization with R</a></li>
<li class="chapter" data-level="2.6" data-path="defining-functions.html"><a href="defining-functions.html"><i class="fa fa-check"></i><b>2.6</b> Defining functions</a></li>
<li class="chapter" data-level="2.7" data-path="concluding-thoughts.html"><a href="concluding-thoughts.html"><i class="fa fa-check"></i><b>2.7</b> Concluding thoughts</a></li>
<li class="chapter" data-level="2.8" data-path="exercises-1.html"><a href="exercises-1.html"><i class="fa fa-check"></i><b>2.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="modeling-rates-03.html"><a href="modeling-rates-03.html"><i class="fa fa-check"></i><b>3</b> Modeling With Rates of Change</a>
<ul>
<li class="chapter" data-level="3.1" data-path="lynx-and-hares.html"><a href="lynx-and-hares.html"><i class="fa fa-check"></i><b>3.1</b> Lynx and Hares</a></li>
<li class="chapter" data-level="3.2" data-path="the-law-of-mass-action.html"><a href="the-law-of-mass-action.html"><i class="fa fa-check"></i><b>3.2</b> The Law of Mass Action</a></li>
<li class="chapter" data-level="3.3" data-path="establishing-species.html"><a href="establishing-species.html"><i class="fa fa-check"></i><b>3.3</b> Establishing species</a></li>
<li class="chapter" data-level="3.4" data-path="other-types-of-functional-responses.html"><a href="other-types-of-functional-responses.html"><i class="fa fa-check"></i><b>3.4</b> Other types of functional responses</a></li>
<li class="chapter" data-level="3.5" data-path="exercises-2.html"><a href="exercises-2.html"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="euler-04.html"><a href="euler-04.html"><i class="fa fa-check"></i><b>4</b> Euler’s Method</a>
<ul>
<li class="chapter" data-level="4.1" data-path="defining-an-algorithm.html"><a href="defining-an-algorithm.html"><i class="fa fa-check"></i><b>4.1</b> Defining an Algorithm</a></li>
<li class="chapter" data-level="4.2" data-path="building-an-iterative-method.html"><a href="building-an-iterative-method.html"><i class="fa fa-check"></i><b>4.2</b> Building an iterative method</a></li>
<li class="chapter" data-level="4.3" data-path="eulers-method-applied-to-systems.html"><a href="eulers-method-applied-to-systems.html"><i class="fa fa-check"></i><b>4.3</b> Euler’s method applied to systems</a></li>
<li class="chapter" data-level="4.4" data-path="more-refined-numerical-solvers.html"><a href="more-refined-numerical-solvers.html"><i class="fa fa-check"></i><b>4.4</b> More refined numerical solvers</a></li>
<li class="chapter" data-level="4.5" data-path="exercises-3.html"><a href="exercises-3.html"><i class="fa fa-check"></i><b>4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="phase-05.html"><a href="phase-05.html"><i class="fa fa-check"></i><b>5</b> Phase Lines and Equilibrium Solutions</a>
<ul>
<li class="chapter" data-level="5.1" data-path="equilibrium-solutions.html"><a href="equilibrium-solutions.html"><i class="fa fa-check"></i><b>5.1</b> Equilibrium solutions</a></li>
<li class="chapter" data-level="5.2" data-path="phase-lines-for-differential-equations.html"><a href="phase-lines-for-differential-equations.html"><i class="fa fa-check"></i><b>5.2</b> Phase lines for differential equations</a></li>
<li class="chapter" data-level="5.3" data-path="a-stability-test-for-equilibrium-solutions.html"><a href="a-stability-test-for-equilibrium-solutions.html"><i class="fa fa-check"></i><b>5.3</b> A stability test for equilibrium solutions</a></li>
<li class="chapter" data-level="5.4" data-path="exercises-4.html"><a href="exercises-4.html"><i class="fa fa-check"></i><b>5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="coupled-06.html"><a href="coupled-06.html"><i class="fa fa-check"></i><b>6</b> Coupled Systems of Equations</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-redux-flu-with-quarantine.html"><a href="model-redux-flu-with-quarantine.html"><i class="fa fa-check"></i><b>6.1</b> Model redux: flu with quarantine</a></li>
<li class="chapter" data-level="6.2" data-path="determining-stability-of-an-equilbrium-solution.html"><a href="determining-stability-of-an-equilbrium-solution.html"><i class="fa fa-check"></i><b>6.2</b> Determining stability of an equilbrium solution</a></li>
<li class="chapter" data-level="6.3" data-path="generating-a-phase-plane-in-r.html"><a href="generating-a-phase-plane-in-r.html"><i class="fa fa-check"></i><b>6.3</b> Generating a phase plane in <code>R</code></a></li>
<li class="chapter" data-level="6.4" data-path="exercises-5.html"><a href="exercises-5.html"><i class="fa fa-check"></i><b>6.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exact-solns-07.html"><a href="exact-solns-07.html"><i class="fa fa-check"></i><b>7</b> Exact Solutions to Differential Equations</a>
<ul>
<li class="chapter" data-level="7.1" data-path="separable-differential-equations.html"><a href="separable-differential-equations.html"><i class="fa fa-check"></i><b>7.1</b> Separable Differential Equations</a></li>
<li class="chapter" data-level="7.2" data-path="integrating-factors.html"><a href="integrating-factors.html"><i class="fa fa-check"></i><b>7.2</b> Integrating factors</a></li>
<li class="chapter" data-level="7.3" data-path="guess-and-check.html"><a href="guess-and-check.html"><i class="fa fa-check"></i><b>7.3</b> Guess and Check</a></li>
<li class="chapter" data-level="7.4" data-path="superposition-of-solutions.html"><a href="superposition-of-solutions.html"><i class="fa fa-check"></i><b>7.4</b> Superposition of solutions</a></li>
<li class="chapter" data-level="7.5" data-path="applying-guess-and-check-more-broadly.html"><a href="applying-guess-and-check-more-broadly.html"><i class="fa fa-check"></i><b>7.5</b> Applying guess and check more broadly</a></li>
<li class="chapter" data-level="7.6" data-path="exercises-6.html"><a href="exercises-6.html"><i class="fa fa-check"></i><b>7.6</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Parameterizing Models with Data</b></span></li>
<li class="chapter" data-level="8" data-path="linear-regression-08.html"><a href="linear-regression-08.html"><i class="fa fa-check"></i><b>8</b> Linear Regression and Curve Fitting</a>
<ul>
<li class="chapter" data-level="8.1" data-path="what-is-parameter-estimation.html"><a href="what-is-parameter-estimation.html"><i class="fa fa-check"></i><b>8.1</b> What is parameter estimation?</a></li>
<li class="chapter" data-level="8.2" data-path="fitting-temperature-data.html"><a href="fitting-temperature-data.html"><i class="fa fa-check"></i><b>8.2</b> Fitting temperature data</a></li>
<li class="chapter" data-level="8.3" data-path="moving-beyond-linear-models.html"><a href="moving-beyond-linear-models.html"><i class="fa fa-check"></i><b>8.3</b> Moving beyond linear models</a></li>
<li class="chapter" data-level="8.4" data-path="can-you-linearize-your-model.html"><a href="can-you-linearize-your-model.html"><i class="fa fa-check"></i><b>8.4</b> Can you linearize your model?</a></li>
<li class="chapter" data-level="8.5" data-path="nonlinear-models.html"><a href="nonlinear-models.html"><i class="fa fa-check"></i><b>8.5</b> Nonlinear models</a></li>
<li class="chapter" data-level="8.6" data-path="exercises-7.html"><a href="exercises-7.html"><i class="fa fa-check"></i><b>8.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="likelihood-09.html"><a href="likelihood-09.html"><i class="fa fa-check"></i><b>9</b> Probability and Likelihood Functions</a>
<ul>
<li class="chapter" data-level="9.1" data-path="linear-regression-part-2.html"><a href="linear-regression-part-2.html"><i class="fa fa-check"></i><b>9.1</b> Linear regression, part 2</a></li>
<li class="chapter" data-level="9.2" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>9.2</b> Probability</a></li>
<li class="chapter" data-level="9.3" data-path="connecting-probabilities-to-linear-regression.html"><a href="connecting-probabilities-to-linear-regression.html"><i class="fa fa-check"></i><b>9.3</b> Connecting probabilities to linear regression</a></li>
<li class="chapter" data-level="9.4" data-path="plotting-likelihood-surfaces.html"><a href="plotting-likelihood-surfaces.html"><i class="fa fa-check"></i><b>9.4</b> Plotting likelihood surfaces</a></li>
<li class="chapter" data-level="9.5" data-path="exercises-8.html"><a href="exercises-8.html"><i class="fa fa-check"></i><b>9.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cost-fns-10.html"><a href="cost-fns-10.html"><i class="fa fa-check"></i><b>10</b> Cost Functions &amp; Bayes’ Rule</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cost-functions-likelihood-functions-in-disguise.html"><a href="cost-functions-likelihood-functions-in-disguise.html"><i class="fa fa-check"></i><b>10.1</b> Cost functions: likelihood functions in disguise</a></li>
<li class="chapter" data-level="10.2" data-path="connection-to-likelihood-functions.html"><a href="connection-to-likelihood-functions.html"><i class="fa fa-check"></i><b>10.2</b> Connection to likelihood functions</a></li>
<li class="chapter" data-level="10.3" data-path="extending-the-cost-function.html"><a href="extending-the-cost-function.html"><i class="fa fa-check"></i><b>10.3</b> Extending the cost function</a></li>
<li class="chapter" data-level="10.4" data-path="conditional-probabilities-and-bayes-rule.html"><a href="conditional-probabilities-and-bayes-rule.html"><i class="fa fa-check"></i><b>10.4</b> Conditional Probabilities and Bayes’ Rule</a></li>
<li class="chapter" data-level="10.5" data-path="bayes-rule-and-linear-regression.html"><a href="bayes-rule-and-linear-regression.html"><i class="fa fa-check"></i><b>10.5</b> Bayes’ Rule and Linear Regression</a></li>
<li class="chapter" data-level="10.6" data-path="exercises-9.html"><a href="exercises-9.html"><i class="fa fa-check"></i><b>10.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="bootstrap-11.html"><a href="bootstrap-11.html"><i class="fa fa-check"></i><b>11</b> The Bootstrap Method</a>
<ul>
<li class="chapter" data-level="11.1" data-path="plotting-histograms-in-r.html"><a href="plotting-histograms-in-r.html"><i class="fa fa-check"></i><b>11.1</b> Plotting histograms in R</a></li>
<li class="chapter" data-level="11.2" data-path="statistical-theory-sampling-distributions.html"><a href="statistical-theory-sampling-distributions.html"><i class="fa fa-check"></i><b>11.2</b> Statistical theory: Sampling distributions</a></li>
<li class="chapter" data-level="11.3" data-path="bootstapping-with-linear-regression.html"><a href="bootstapping-with-linear-regression.html"><i class="fa fa-check"></i><b>11.3</b> Bootstapping with linear regression</a></li>
<li class="chapter" data-level="11.4" data-path="exercises-10.html"><a href="exercises-10.html"><i class="fa fa-check"></i><b>11.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="the-metropolis-hastings-algorithm.html"><a href="the-metropolis-hastings-algorithm.html"><i class="fa fa-check"></i><b>12</b> The Metropolis-Hastings Algorithm</a>
<ul>
<li class="chapter" data-level="12.1" data-path="estimating-the-growth-of-a-dog.html"><a href="estimating-the-growth-of-a-dog.html"><i class="fa fa-check"></i><b>12.1</b> Estimating the growth of a dog</a></li>
<li class="chapter" data-level="12.2" data-path="applying-the-likelihood-to-evaluate-parameters.html"><a href="applying-the-likelihood-to-evaluate-parameters.html"><i class="fa fa-check"></i><b>12.2</b> Applying the likelihood to evaluate parameters</a></li>
<li class="chapter" data-level="12.3" data-path="concluding-points.html"><a href="concluding-points.html"><i class="fa fa-check"></i><b>12.3</b> Concluding points</a></li>
<li class="chapter" data-level="12.4" data-path="exercises-11.html"><a href="exercises-11.html"><i class="fa fa-check"></i><b>12.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="mcmc-13.html"><a href="mcmc-13.html"><i class="fa fa-check"></i><b>13</b> Markov Chain Monte Carlo Parameter Estimation</a>
<ul>
<li class="chapter" data-level="13.1" data-path="mcmc-parameter-estimation-with-an-empirical-model.html"><a href="mcmc-parameter-estimation-with-an-empirical-model.html"><i class="fa fa-check"></i><b>13.1</b> MCMC Parameter Estimation with an Empirical Model</a></li>
<li class="chapter" data-level="13.2" data-path="mcmc-parameter-estimation-with-a-differential-equation-model.html"><a href="mcmc-parameter-estimation-with-a-differential-equation-model.html"><i class="fa fa-check"></i><b>13.2</b> MCMC Parameter Estimation with a Differential Equation Model</a></li>
<li class="chapter" data-level="13.3" data-path="timing-your-code.html"><a href="timing-your-code.html"><i class="fa fa-check"></i><b>13.3</b> Timing your code</a></li>
<li class="chapter" data-level="13.4" data-path="further-extensions-to-mcmc.html"><a href="further-extensions-to-mcmc.html"><i class="fa fa-check"></i><b>13.4</b> Further extensions to MCMC</a></li>
<li class="chapter" data-level="13.5" data-path="exercises-12.html"><a href="exercises-12.html"><i class="fa fa-check"></i><b>13.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="information-criteria-14.html"><a href="information-criteria-14.html"><i class="fa fa-check"></i><b>14</b> Information Criteria</a>
<ul>
<li class="chapter" data-level="14.1" data-path="why-bother-with-more-models.html"><a href="why-bother-with-more-models.html"><i class="fa fa-check"></i><b>14.1</b> Why bother with more models?</a></li>
<li class="chapter" data-level="14.2" data-path="the-information-on-information-criterion.html"><a href="the-information-on-information-criterion.html"><i class="fa fa-check"></i><b>14.2</b> The Information on Information Criterion</a></li>
<li class="chapter" data-level="14.3" data-path="a-few-cautionary-notes.html"><a href="a-few-cautionary-notes.html"><i class="fa fa-check"></i><b>14.3</b> A few cautionary notes</a></li>
<li class="chapter" data-level="14.4" data-path="exercises-13.html"><a href="exercises-13.html"><i class="fa fa-check"></i><b>14.4</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>III Stability Analysis for Differential Equations</b></span></li>
<li class="chapter" data-level="15" data-path="linearsystems-15.html"><a href="linearsystems-15.html"><i class="fa fa-check"></i><b>15</b> Systems of linear equations</a>
<ul>
<li class="chapter" data-level="15.1" data-path="equilibrium-solutions-1.html"><a href="equilibrium-solutions-1.html"><i class="fa fa-check"></i><b>15.1</b> Equilibrium solutions</a></li>
<li class="chapter" data-level="15.2" data-path="the-phase-plane.html"><a href="the-phase-plane.html"><i class="fa fa-check"></i><b>15.2</b> The phase plane</a></li>
<li class="chapter" data-level="15.3" data-path="stability-of-solutions.html"><a href="stability-of-solutions.html"><i class="fa fa-check"></i><b>15.3</b> Stability of solutions</a></li>
<li class="chapter" data-level="15.4" data-path="exercises-14.html"><a href="exercises-14.html"><i class="fa fa-check"></i><b>15.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="nonlinear-16.html"><a href="nonlinear-16.html"><i class="fa fa-check"></i><b>16</b> Systems of nonlinear equations</a>
<ul>
<li class="chapter" data-level="16.1" data-path="determining-equilibrium-solutions.html"><a href="determining-equilibrium-solutions.html"><i class="fa fa-check"></i><b>16.1</b> Determining equilibrium solutions</a></li>
<li class="chapter" data-level="16.2" data-path="stability-of-an-equilibrium-solution.html"><a href="stability-of-an-equilibrium-solution.html"><i class="fa fa-check"></i><b>16.2</b> Stability of an equilibrium solution</a></li>
<li class="chapter" data-level="16.3" data-path="exercises-15.html"><a href="exercises-15.html"><i class="fa fa-check"></i><b>16.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="jacobian-17.html"><a href="jacobian-17.html"><i class="fa fa-check"></i><b>17</b> Local Linearization and the Jacobian</a>
<ul>
<li class="chapter" data-level="17.1" data-path="a-first-example.html"><a href="a-first-example.html"><i class="fa fa-check"></i><b>17.1</b> A first example</a></li>
<li class="chapter" data-level="17.2" data-path="the-lynx-hare-revisited.html"><a href="the-lynx-hare-revisited.html"><i class="fa fa-check"></i><b>17.2</b> The lynx hare revisited</a></li>
<li class="chapter" data-level="17.3" data-path="tangent-plane-approximations.html"><a href="tangent-plane-approximations.html"><i class="fa fa-check"></i><b>17.3</b> Tangent plane approximations</a></li>
<li class="chapter" data-level="17.4" data-path="the-jacobian-matrix.html"><a href="the-jacobian-matrix.html"><i class="fa fa-check"></i><b>17.4</b> The Jacobian matrix</a></li>
<li class="chapter" data-level="17.5" data-path="predator-prey-with-logistic-growth.html"><a href="predator-prey-with-logistic-growth.html"><i class="fa fa-check"></i><b>17.5</b> Predator prey with logistic growth</a></li>
<li class="chapter" data-level="17.6" data-path="concluding-thoughts-1.html"><a href="concluding-thoughts-1.html"><i class="fa fa-check"></i><b>17.6</b> Concluding thoughts</a></li>
<li class="chapter" data-level="17.7" data-path="exercises-16.html"><a href="exercises-16.html"><i class="fa fa-check"></i><b>17.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="eigenvalues-18.html"><a href="eigenvalues-18.html"><i class="fa fa-check"></i><b>18</b> What are eigenvalues?</a>
<ul>
<li class="chapter" data-level="18.1" data-path="straight-line-solutions.html"><a href="straight-line-solutions.html"><i class="fa fa-check"></i><b>18.1</b> Straight line solutions</a></li>
<li class="chapter" data-level="18.2" data-path="computing-eigenvalues-and-eigenvectors.html"><a href="computing-eigenvalues-and-eigenvectors.html"><i class="fa fa-check"></i><b>18.2</b> Computing eigenvalues and eigenvectors</a></li>
<li class="chapter" data-level="18.3" data-path="what-do-eigenvalues-tell-us.html"><a href="what-do-eigenvalues-tell-us.html"><i class="fa fa-check"></i><b>18.3</b> What do eigenvalues tell us?</a></li>
<li class="chapter" data-level="18.4" data-path="concluding-thoughts-2.html"><a href="concluding-thoughts-2.html"><i class="fa fa-check"></i><b>18.4</b> Concluding thoughts</a></li>
<li class="chapter" data-level="18.5" data-path="exercises-17.html"><a href="exercises-17.html"><i class="fa fa-check"></i><b>18.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="stability-19.html"><a href="stability-19.html"><i class="fa fa-check"></i><b>19</b> Qualitative Stability Analysis</a>
<ul>
<li class="chapter" data-level="19.1" data-path="two-dimensional-linear-systems-the-general-case.html"><a href="two-dimensional-linear-systems-the-general-case.html"><i class="fa fa-check"></i><b>19.1</b> Two dimensional linear systems: the general case</a></li>
<li class="chapter" data-level="19.2" data-path="sensitivity-to-parameters-with-the-trace-determinant.html"><a href="sensitivity-to-parameters-with-the-trace-determinant.html"><i class="fa fa-check"></i><b>19.2</b> Sensitivity to parameters with the trace-determinant</a></li>
<li class="chapter" data-level="19.3" data-path="higher-dimensional-stability.html"><a href="higher-dimensional-stability.html"><i class="fa fa-check"></i><b>19.3</b> Higher dimensional stability</a></li>
<li class="chapter" data-level="19.4" data-path="exercises-18.html"><a href="exercises-18.html"><i class="fa fa-check"></i><b>19.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="bifurcation-20.html"><a href="bifurcation-20.html"><i class="fa fa-check"></i><b>20</b> Bifurcation</a>
<ul>
<li class="chapter" data-level="20.1" data-path="a-series-of-equations.html"><a href="a-series-of-equations.html"><i class="fa fa-check"></i><b>20.1</b> A series of equations</a></li>
<li class="chapter" data-level="20.2" data-path="bifurcations-with-systems-of-equations.html"><a href="bifurcations-with-systems-of-equations.html"><i class="fa fa-check"></i><b>20.2</b> Bifurcations with systems of equations</a></li>
<li class="chapter" data-level="20.3" data-path="limit-cycles-and-bifurcations-with-systems-of-equations.html"><a href="limit-cycles-and-bifurcations-with-systems-of-equations.html"><i class="fa fa-check"></i><b>20.3</b> Limit Cycles and Bifurcations with systems of equations</a></li>
<li class="chapter" data-level="20.4" data-path="exercises-19.html"><a href="exercises-19.html"><i class="fa fa-check"></i><b>20.4</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>IV Stochastic Differential Equations</b></span></li>
<li class="chapter" data-level="21" data-path="stoch-sys-21.html"><a href="stoch-sys-21.html"><i class="fa fa-check"></i><b>21</b> Stochastic Biological Systems</a>
<ul>
<li class="chapter" data-level="21.1" data-path="a-discrete-system.html"><a href="a-discrete-system.html"><i class="fa fa-check"></i><b>21.1</b> A discrete system</a></li>
<li class="chapter" data-level="21.2" data-path="environmental-stochasticity.html"><a href="environmental-stochasticity.html"><i class="fa fa-check"></i><b>21.2</b> Environmental Stochasticity</a></li>
<li class="chapter" data-level="21.3" data-path="discrete-systems-of-equations.html"><a href="discrete-systems-of-equations.html"><i class="fa fa-check"></i><b>21.3</b> Discrete systems of equations</a></li>
<li class="chapter" data-level="21.4" data-path="exercises-20.html"><a href="exercises-20.html"><i class="fa fa-check"></i><b>21.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="stoch-sim-22.html"><a href="stoch-sim-22.html"><i class="fa fa-check"></i><b>22</b> Simulating and Visualizing Randomness</a>
<ul>
<li class="chapter" data-level="22.1" data-path="ensemble-averages.html"><a href="ensemble-averages.html"><i class="fa fa-check"></i><b>22.1</b> Ensemble Averages</a></li>
<li class="chapter" data-level="22.2" data-path="computing-ensemble-averages.html"><a href="computing-ensemble-averages.html"><i class="fa fa-check"></i><b>22.2</b> Computing ensemble averages</a></li>
<li class="chapter" data-level="22.3" data-path="doing-many-simulations-and-visualizing.html"><a href="doing-many-simulations-and-visualizing.html"><i class="fa fa-check"></i><b>22.3</b> Doing many simulations and visualizing</a></li>
<li class="chapter" data-level="22.4" data-path="exercises-21.html"><a href="exercises-21.html"><i class="fa fa-check"></i><b>22.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="random-walks-23.html"><a href="random-walks-23.html"><i class="fa fa-check"></i><b>23</b> Random Walks</a>
<ul>
<li class="chapter" data-level="23.1" data-path="random-walk-on-a-number-line.html"><a href="random-walk-on-a-number-line.html"><i class="fa fa-check"></i><b>23.1</b> Random walk on a number line</a></li>
<li class="chapter" data-level="23.2" data-path="more-realizatons.html"><a href="more-realizatons.html"><i class="fa fa-check"></i><b>23.2</b> More realizatons</a></li>
<li class="chapter" data-level="23.3" data-path="random-walk-mathematics.html"><a href="random-walk-mathematics.html"><i class="fa fa-check"></i><b>23.3</b> Random walk mathematics</a></li>
<li class="chapter" data-level="23.4" data-path="continuous-random-walks-diffusion.html"><a href="continuous-random-walks-diffusion.html"><i class="fa fa-check"></i><b>23.4</b> Continuous random walks (diffusion)</a></li>
<li class="chapter" data-level="23.5" data-path="exercises-22.html"><a href="exercises-22.html"><i class="fa fa-check"></i><b>23.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="diffusion-24.html"><a href="diffusion-24.html"><i class="fa fa-check"></i><b>24</b> Diffusion</a>
<ul>
<li class="chapter" data-level="24.1" data-path="random-walk-redux.html"><a href="random-walk-redux.html"><i class="fa fa-check"></i><b>24.1</b> Random walk redux</a></li>
<li class="chapter" data-level="24.2" data-path="concluding-thoughts-3.html"><a href="concluding-thoughts-3.html"><i class="fa fa-check"></i><b>24.2</b> Concluding Thoughts</a></li>
<li class="chapter" data-level="24.3" data-path="exercises-23.html"><a href="exercises-23.html"><i class="fa fa-check"></i><b>24.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="sdes-25.html"><a href="sdes-25.html"><i class="fa fa-check"></i><b>25</b> Stochastic Differential Equations</a>
<ul>
<li class="chapter" data-level="25.1" data-path="the-stochastic-logistic-model.html"><a href="the-stochastic-logistic-model.html"><i class="fa fa-check"></i><b>25.1</b> The stochastic logistic model</a></li>
<li class="chapter" data-level="25.2" data-path="the-euler-maruyama-method.html"><a href="the-euler-maruyama-method.html"><i class="fa fa-check"></i><b>25.2</b> The Euler-Maruyama Method</a></li>
<li class="chapter" data-level="25.3" data-path="adding-stochasticity-to-parameters.html"><a href="adding-stochasticity-to-parameters.html"><i class="fa fa-check"></i><b>25.3</b> Adding stochasticity to parameters</a></li>
<li class="chapter" data-level="25.4" data-path="concluding-thoughts-4.html"><a href="concluding-thoughts-4.html"><i class="fa fa-check"></i><b>25.4</b> Concluding thoughts</a></li>
<li class="chapter" data-level="25.5" data-path="exercises-24.html"><a href="exercises-24.html"><i class="fa fa-check"></i><b>25.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="simul-stoch-26.html"><a href="simul-stoch-26.html"><i class="fa fa-check"></i><b>26</b> Simulating Stochastic Dynamics</a>
<ul>
<li class="chapter" data-level="26.1" data-path="the-stochastic-logistic-model-redux.html"><a href="the-stochastic-logistic-model-redux.html"><i class="fa fa-check"></i><b>26.1</b> The stochastic logistic model redux</a></li>
<li class="chapter" data-level="26.2" data-path="a-stochastic-system-of-equations.html"><a href="a-stochastic-system-of-equations.html"><i class="fa fa-check"></i><b>26.2</b> A stochastic system of equations</a></li>
<li class="chapter" data-level="26.3" data-path="generalizing-the-approach-.html"><a href="generalizing-the-approach-.html"><i class="fa fa-check"></i><b>26.3</b> Generalizing the approach.</a></li>
<li class="chapter" data-level="26.4" data-path="exercises-25.html"><a href="exercises-25.html"><i class="fa fa-check"></i><b>26.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="solvingSDEs-27.html"><a href="solvingSDEs-27.html"><i class="fa fa-check"></i><b>27</b> Solving Stochastic Differential Equations</a>
<ul>
<li class="chapter" data-level="27.1" data-path="meet-the-fokker-planck-equation.html"><a href="meet-the-fokker-planck-equation.html"><i class="fa fa-check"></i><b>27.1</b> Meet the Fokker-Planck Equation</a></li>
<li class="chapter" data-level="27.2" data-path="exercises-26.html"><a href="exercises-26.html"><i class="fa fa-check"></i><b>27.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></li>
<li><a href="https://bookdown.org" target="_blank">Built with Bookdown + RStudio</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploring Modeling with Data and Differential Equations Using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="computing-ensemble-averages" class="section level2" number="22.2">
<h2><span class="header-section-number">22.2</span> Computing ensemble averages</h2>
<p>Let’s build up how to compute an ensemble average step by step. For example let’s say we have the following data in Table <a href="computing-ensemble-averages.html#tab:simul-table">22.1</a>. Notice how all the simulations (<code>sim1</code>, <code>sim2</code>, <code>sim3</code>) share the variable <code>t</code> in common, so it makes sense to plot them on the same axis in Figure <a href="computing-ensemble-averages.html#fig:simul-graph">22.3</a>. We call a plot of all of the simulations together a <em>spaghetti plot</em>, because it can look like a bowl of spaghetti noodles was dumped all over the plot.</p>
<table>
<caption>
<span id="tab:simul-table">Table 22.1: </span>Simulations of a variable at different times.
</caption>
<thead>
<tr>
<th style="text-align:right;">
t
</th>
<th style="text-align:right;">
sim1
</th>
<th style="text-align:right;">
sim2
</th>
<th style="text-align:right;">
sim3
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.92
</td>
<td style="text-align:right;">
2.32
</td>
<td style="text-align:right;">
0.26
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
0.22
</td>
<td style="text-align:right;">
4.28
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.59
</td>
<td style="text-align:right;">
3.51
</td>
<td style="text-align:right;">
3.14
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4.23
</td>
<td style="text-align:right;">
2.41
</td>
<td style="text-align:right;">
1.11
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
4.29
</td>
<td style="text-align:right;">
2.33
</td>
<td style="text-align:right;">
2.26
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="computing-ensemble-averages.html#cb131-1" aria-hidden="true" tabindex="-1"></a>my_table <span class="sc">%&gt;%</span></span>
<span id="cb131-2"><a href="computing-ensemble-averages.html#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb131-3"><a href="computing-ensemble-averages.html#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> sim1)) <span class="sc">+</span></span>
<span id="cb131-4"><a href="computing-ensemble-averages.html#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> sim1)) <span class="sc">+</span></span>
<span id="cb131-5"><a href="computing-ensemble-averages.html#cb131-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> sim2)) <span class="sc">+</span></span>
<span id="cb131-6"><a href="computing-ensemble-averages.html#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> sim2)) <span class="sc">+</span></span>
<span id="cb131-7"><a href="computing-ensemble-averages.html#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> sim3)) <span class="sc">+</span></span>
<span id="cb131-8"><a href="computing-ensemble-averages.html#cb131-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> sim3)) <span class="sc">+</span></span>
<span id="cb131-9"><a href="computing-ensemble-averages.html#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Simulation Value&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:simul-graph-prev"></span>
<img src="series_files/figure-html/simul-graph-prev-1.png" alt="Initial Timeseries plot of the three simulations from Table \@ref(tab:simul-table)." width="384" />
<p class="caption">
Figure 22.2: Initial Timeseries plot of the three simulations from Table <a href="computing-ensemble-averages.html#tab:simul-table">22.1</a>.
</p>
</div>
<p>One thing to adjust in the code used to produce the spaghetti plot in Figure <a href="computing-ensemble-averages.html#fig:simul-graph-prev">22.2</a> is that the code is really long - we needed a <code>geom_point</code> and <code>geom_line</code> for each simulation. While this isn’t bad when you have three simulations, one lesson we will learn is that the more simulations gives you better confidence in your results. If we have 500 simulations this would be a pain to code! Fortunately there is a command called <code>pivot_longer</code> that gathers different columns together (Table <a href="computing-ensemble-averages.html#tab:simul-table-long">22.2</a>.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="computing-ensemble-averages.html#cb132-1" aria-hidden="true" tabindex="-1"></a>my_table_long <span class="ot">&lt;-</span> my_table <span class="sc">%&gt;%</span></span>
<span id="cb132-2"><a href="computing-ensemble-averages.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">&quot;sim1&quot;</span><span class="sc">:</span><span class="st">&quot;sim3&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;name&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:simul-table-long">Table 22.2: </span>Simulations of a variable at different times, condensed into a long table.
</caption>
<thead>
<tr>
<th style="text-align:right;">
t
</th>
<th style="text-align:left;">
name
</th>
<th style="text-align:right;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
sim1
</td>
<td style="text-align:right;">
3.92
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
sim2
</td>
<td style="text-align:right;">
2.32
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
sim3
</td>
<td style="text-align:right;">
0.26
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
sim1
</td>
<td style="text-align:right;">
0.81
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
sim2
</td>
<td style="text-align:right;">
0.22
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
sim3
</td>
<td style="text-align:right;">
4.28
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
sim1
</td>
<td style="text-align:right;">
1.59
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
sim2
</td>
<td style="text-align:right;">
3.51
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
sim3
</td>
<td style="text-align:right;">
3.14
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
sim1
</td>
<td style="text-align:right;">
4.23
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
sim2
</td>
<td style="text-align:right;">
2.41
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
sim3
</td>
<td style="text-align:right;">
1.11
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
sim1
</td>
<td style="text-align:right;">
4.29
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
sim2
</td>
<td style="text-align:right;">
2.33
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
sim3
</td>
<td style="text-align:right;">
2.26
</td>
</tr>
</tbody>
</table>
<p>Notice how the command <code>pivot_longer</code> takes the different simulations (<code>sim1</code>, <code>sim2</code>, <code>sim3</code>) and reassigns the column names to a new column <code>name</code> and the values in the different columns to <code>value</code>. This process called pivoting creates a new data frame, which is easier to generate the spaghetti plot.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="computing-ensemble-averages.html#cb133-1" aria-hidden="true" tabindex="-1"></a>my_table_long <span class="sc">%&gt;%</span></span>
<span id="cb133-2"><a href="computing-ensemble-averages.html#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> value, <span class="at">group =</span> name)) <span class="sc">+</span></span>
<span id="cb133-3"><a href="computing-ensemble-averages.html#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb133-4"><a href="computing-ensemble-averages.html#cb133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb133-5"><a href="computing-ensemble-averages.html#cb133-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Simulation Value&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:simul-graph"></span>
<img src="series_files/figure-html/simul-graph-1.png" alt="Timeseries plot of the three simulations from the pivoted data frame." width="384" />
<p class="caption">
Figure 22.3: Timeseries plot of the three simulations from the pivoted data frame.
</p>
</div>
<div id="grouping" class="section level3" number="22.2.1">
<h3><span class="header-section-number">22.2.1</span> Grouping</h3>
<p>The next step after pivoting is to collect the time points at <span class="math inline">\(t=1\)</span> together, <span class="math inline">\(t=2\)</span> together, and so on. In each of these groups we then compute the mean (average). This process is called <em>grouping</em> and then applying a summarizing function to all the members in a particular group (which in this case is the mean). Here is the code to do that process with the data frame <code>my_table_long</code>:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="computing-ensemble-averages.html#cb134-1" aria-hidden="true" tabindex="-1"></a>summarized_table <span class="ot">&lt;-</span> my_table_long <span class="sc">%&gt;%</span></span>
<span id="cb134-2"><a href="computing-ensemble-averages.html#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(t) <span class="sc">%&gt;%</span></span>
<span id="cb134-3"><a href="computing-ensemble-averages.html#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_val =</span> <span class="fu">mean</span>(value))</span></code></pre></div>
<table>
<caption>
<span id="tab:table-summary">Table 22.3: </span>Simulations of a variable at different times, along with the mean value (last column).
</caption>
<thead>
<tr>
<th style="text-align:right;">
t
</th>
<th style="text-align:right;">
mean_val
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2.166667
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
1.770000
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2.746667
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2.583333
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2.960000
</td>
</tr>
</tbody>
</table>
<p>Let’s break this down.</p>
<ul>
<li>The command <code>group_by(t)</code> means collect similar time points together</li>
<li>The next line computes the mean. The command <code>summarize</code> means to that we are going to create a new data frame column (labeled <code>mean_val</code> that is the mean of all the grouped times, from the <code>value</code> column.</li>
</ul>
<p>We can add this mean value to our data (Figure <a href="computing-ensemble-averages.html#fig:simul-graph-rev">22.4</a>), represented with a thick red line.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="computing-ensemble-averages.html#cb135-1" aria-hidden="true" tabindex="-1"></a>my_table_long <span class="sc">%&gt;%</span></span>
<span id="cb135-2"><a href="computing-ensemble-averages.html#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> value, <span class="at">group =</span> name)) <span class="sc">+</span></span>
<span id="cb135-3"><a href="computing-ensemble-averages.html#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb135-4"><a href="computing-ensemble-averages.html#cb135-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb135-5"><a href="computing-ensemble-averages.html#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> summarized_table, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> mean_val), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb135-6"><a href="computing-ensemble-averages.html#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> summarized_table, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> mean_val), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb135-7"><a href="computing-ensemble-averages.html#cb135-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb135-8"><a href="computing-ensemble-averages.html#cb135-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Simulation Value&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:simul-graph-rev"></span>
<img src="series_files/figure-html/simul-graph-rev-1.png" alt="Timeseries plot of the three simulations." width="384" />
<p class="caption">
Figure 22.4: Timeseries plot of the three simulations.
</p>
</div>
<p>Notice how we added the additional <code>geom_point</code> and <code>geom_line</code> with the option <code>inherit.aes = FALSE</code>. This stands for “inherit aesthetics” When you add a new data frame to a plot, the initial aesthetics (such as the <code>color</code> or the <code>group</code>) are passed on. Setting <code>inherit.aes = FALSE</code> allows you to work with a clean slate.</p>
<p>Computing the other parts of the ensemble average requires knowledge of how to compute percentiles of a distribution of values. For our purposes here we will use the 95% confidence interval, so that means the 2.5th, 97.5th percentile (which only 5% of the values will be outside of the specified interval), along with the median value (50th percentile). Let’s take a look at the code how do do that:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="computing-ensemble-averages.html#cb136-1" aria-hidden="true" tabindex="-1"></a>quantile_vals <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>)</span>
<span id="cb136-2"><a href="computing-ensemble-averages.html#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="computing-ensemble-averages.html#cb136-3" aria-hidden="true" tabindex="-1"></a>quantile_table <span class="ot">&lt;-</span> my_table_long <span class="sc">%&gt;%</span></span>
<span id="cb136-4"><a href="computing-ensemble-averages.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(t) <span class="sc">%&gt;%</span></span>
<span id="cb136-5"><a href="computing-ensemble-averages.html#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb136-6"><a href="computing-ensemble-averages.html#cb136-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">q_val =</span> <span class="fu">quantile</span>(value,</span>
<span id="cb136-7"><a href="computing-ensemble-averages.html#cb136-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> quantile_vals</span>
<span id="cb136-8"><a href="computing-ensemble-averages.html#cb136-8" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb136-9"><a href="computing-ensemble-averages.html#cb136-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">q_name =</span> quantile_vals</span>
<span id="cb136-10"><a href="computing-ensemble-averages.html#cb136-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb136-11"><a href="computing-ensemble-averages.html#cb136-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;q_name&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;q_val&quot;</span>, <span class="at">names_glue =</span> <span class="st">&quot;q{q_name}&quot;</span>)</span></code></pre></div>
<table>
<caption>
<span id="tab:quantile-table">Table 22.4: </span>Simulations of a variable at different times, along with the median and the 95% confidence interval.
</caption>
<thead>
<tr>
<th style="text-align:right;">
t
</th>
<th style="text-align:right;">
q0.025
</th>
<th style="text-align:right;">
q0.5
</th>
<th style="text-align:right;">
q0.975
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.3630
</td>
<td style="text-align:right;">
2.32
</td>
<td style="text-align:right;">
3.8400
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
0.2495
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
4.1065
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1.6675
</td>
<td style="text-align:right;">
3.14
</td>
<td style="text-align:right;">
3.4915
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1.1750
</td>
<td style="text-align:right;">
2.41
</td>
<td style="text-align:right;">
4.1390
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
2.2635
</td>
<td style="text-align:right;">
2.33
</td>
<td style="text-align:right;">
4.1920
</td>
</tr>
</tbody>
</table>
<p>While this code is a little more involved, let’s break it down piece by piece:</p>
<ul>
<li>To make things easier the variable <code>quantile_vals</code> computes the different quantiles, expressed between 0 to 1 - so 2.5% is 0.025, 50% is 0.5, and 97.5% is .975.</li>
<li>As above, we are still looking grouping by the variable <code>t</code> and summarizing our data frame.</li>
<li>However rather than applying the mean, we are using the command <code>quantile</code>, whose value is computed with the new column <code>q_val</code>. Like the mean, we define which columns we apply the quantile function in the column <code>value</code>. We use <code>probs = quantile_vals</code> to specify the quantiles that we wish to compute.</li>
<li>We also create a new column called <code>q_name</code> the contains the names of the quantile probabilities.</li>
<li>The command <code>pivot_wider</code> takes the values in <code>q_val</code> with the associated names in <code>q_name</code> and creates new columns associated with each quantile. This process of making a data frame wider is the opposite of making a skinny and tall data frame with <code>pivot_longer</code>. Notice that a key convention in column names is that they don’t start with a number, so we <em>glue</em> a <code>q</code> onto the names of the column.</li>
</ul>
<p>Wow. This is getting involved. One thing to keep in mind is that the the code as written should be easily adaptable if you need to compute an ensemble average. The last command about pivoting may seem foreign, but learning how to pivot data is a good skill to invest time in. If you take an introductory data science or data visualization course I bet you will learn more about the role of pivoting data - but for now you can just adapt the above code to your needs</p>
<p>Now onto plotting the data. What we will do is plot the ensemble average as a ribbon, so that is a new plot <code>geom_ribbon</code>. It requires a few more aesthetics (<code>ymin</code> and <code>ymax</code>, or the minimum and maximum y values to be plotted).</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="computing-ensemble-averages.html#cb137-1" aria-hidden="true" tabindex="-1"></a>my_table_long <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="computing-ensemble-averages.html#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb137-3"><a href="computing-ensemble-averages.html#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb137-4"><a href="computing-ensemble-averages.html#cb137-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb137-5"><a href="computing-ensemble-averages.html#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> quantile_table, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> q0<span class="fl">.5</span>), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb137-6"><a href="computing-ensemble-averages.html#cb137-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> quantile_table, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">y =</span> q0<span class="fl">.5</span>), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb137-7"><a href="computing-ensemble-averages.html#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> quantile_table, <span class="fu">aes</span>(<span class="at">x =</span> t, <span class="at">ymin =</span> q0<span class="fl">.025</span>, <span class="at">ymax =</span> q0<span class="fl">.975</span>), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">fill =</span> <span class="st">&quot;red&quot;</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb137-8"><a href="computing-ensemble-averages.html#cb137-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb137-9"><a href="computing-ensemble-averages.html#cb137-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Simulation Value&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:simul-graph-conf"></span>
<img src="series_files/figure-html/simul-graph-conf-1.png" alt="Timeseries plot of the three simulations, along with the 95\% confidence interval (red)." width="384" />
<p class="caption">
Figure 22.5: Timeseries plot of the three simulations, along with the 95% confidence interval (red).
</p>
</div>
<p>A lot of this code to produce Figure <a href="computing-ensemble-averages.html#fig:simul-graph-conf">22.5</a> is similar to when we plotted the mean value (Figure <a href="computing-ensemble-averages.html#fig:simul-graph-rev">22.4</a>), but we changed the second data frame to be plotted to <code>quantile_table</code> and included the <code>geom_ribbon</code> command. The command <code>alpha = 0.2</code> refers to the transparency of the plot. The <code>fill</code> aesthetic just provides the shading (in other words the fill) between <code>ymin</code> and <code>ymax</code>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ensemble-averages.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="doing-many-simulations-and-visualizing.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jules32/bookdown-tutorial/edit/master/22-stochasticSimulation.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://jmzobitz.github.io/ModelingWithR/22-stochasticSimulation.Rmd",
"text": null
},
"download": {},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
