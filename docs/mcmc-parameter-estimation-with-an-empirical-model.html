<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.1 MCMC Parameter Estimation with an Empirical Model | Exploring modeling with data and differential equations using R</title>
  <meta name="description" content="A textbook used for MAT 369 at Augsburg University." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2.1 MCMC Parameter Estimation with an Empirical Model | Exploring modeling with data and differential equations using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A textbook used for MAT 369 at Augsburg University." />
  <meta name="github-repo" content="openscapes/series" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.1 MCMC Parameter Estimation with an Empirical Model | Exploring modeling with data and differential equations using R" />
  
  <meta name="twitter:description" content="A textbook used for MAT 369 at Augsburg University." />
  

<meta name="author" content="John M. Zobitz" />


<meta name="date" content="2021-08-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mcmc.html"/>
<link rel="next" href="mcmc-parameter-estimation-with-a-differential-equation-model.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="lib/css/style.css" type="text/css" />
<link rel="stylesheet" href="lib/css/lesson.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Modeling with Data and Differential Equations in R</strong><br>by John Zobitz</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a>
<ul>
<li class="chapter" data-level="1.1" data-path="computational-code.html"><a href="computational-code.html"><i class="fa fa-check"></i><b>1.1</b> Computational code</a></li>
<li class="chapter" data-level="1.2" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i><b>1.2</b> Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mcmc.html"><a href="mcmc.html"><i class="fa fa-check"></i><b>2</b> Markov Chain Monte Carlo Parameter Estimation</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mcmc-parameter-estimation-with-an-empirical-model.html"><a href="mcmc-parameter-estimation-with-an-empirical-model.html"><i class="fa fa-check"></i><b>2.1</b> MCMC Parameter Estimation with an Empirical Model</a></li>
<li class="chapter" data-level="2.2" data-path="mcmc-parameter-estimation-with-a-differential-equation-model.html"><a href="mcmc-parameter-estimation-with-a-differential-equation-model.html"><i class="fa fa-check"></i><b>2.2</b> MCMC Parameter Estimation with a Differential Equation Model</a></li>
<li class="chapter" data-level="2.3" data-path="timing-your-code.html"><a href="timing-your-code.html"><i class="fa fa-check"></i><b>2.3</b> Timing your code</a></li>
<li class="chapter" data-level="2.4" data-path="further-extensions-to-mcmc.html"><a href="further-extensions-to-mcmc.html"><i class="fa fa-check"></i><b>2.4</b> Further extensions to MCMC</a></li>
<li class="chapter" data-level="2.5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>2.5</b> Exercises</a></li>
</ul></li>
<li class="divider"></li>
<li style="padding: 10px 15px; font-weight: bold;">Open access book-in-progress</li>
<li><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></li>
<li><a href="https://bookdown.org" target="_blank">Built with Bookdown + RStudio</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Exploring modeling with data and differential equations using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mcmc-parameter-estimation-with-an-empirical-model" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> MCMC Parameter Estimation with an Empirical Model</h2>
<p>Here are going to return to the problem exploring the phosphorous content in algae (denoted by <span class="math inline">\(x\)</span>) to the phosphorous content in daphnia (denoted by <span class="math inline">\(y\)</span>).</p>
<p>The equation we are going to fit is:</p>
<p><span class="math display" id="eq:phos-13">\[\begin{equation}
y = c \cdot x^{1/\theta} \tag{2.1}
\end{equation}\]</span></p>
<p>Equation <a href="mcmc-parameter-estimation-with-an-empirical-model.html#eq:phos-13">(2.1)</a> has two parameters <span class="math inline">\(c\)</span> and <span class="math inline">\(theta\)</span>, which range from <span class="math inline">\(0 \leq c \leq 2\)</span> and <span class="math inline">\(1 \leq \theta \leq 20\)</span>, which we define below:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the model</span></span>
<span id="cb2-2"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb2-2" aria-hidden="true" tabindex="-1"></a>phos_model <span class="ot">&lt;-</span> daphnia <span class="sc">~</span> c<span class="sc">*</span>algae<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>theta)</span>
<span id="cb2-3"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the parameters that you will use with their bounds</span></span>
<span id="cb2-5"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb2-5" aria-hidden="true" tabindex="-1"></a>phos_param <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;c&quot;</span>,<span class="st">&quot;theta&quot;</span>),</span>
<span id="cb2-6"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb2-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">lower_bound =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb2-7"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb2-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">upper_bound =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">20</span>))</span></code></pre></div>
<p>The data that we use is the dataset <code>phosphorous</code>, which is already located in the <code>MAT369Code</code> package):</p>
<table>
<thead>
<tr>
<th style="text-align:right;">
algae
</th>
<th style="text-align:right;">
daphnia
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.05376
</td>
<td style="text-align:right;">
1.08198
</td>
</tr>
<tr>
<td style="text-align:right;">
0.06506
</td>
<td style="text-align:right;">
1.13836
</td>
</tr>
<tr>
<td style="text-align:right;">
0.08217
</td>
<td style="text-align:right;">
1.26388
</td>
</tr>
<tr>
<td style="text-align:right;">
0.11031
</td>
<td style="text-align:right;">
1.43258
</td>
</tr>
<tr>
<td style="text-align:right;">
0.16061
</td>
<td style="text-align:right;">
1.45699
</td>
</tr>
<tr>
<td style="text-align:right;">
0.64414
</td>
<td style="text-align:right;">
1.51296
</td>
</tr>
</tbody>
</table>
<p>The final piece is to determine the number of iterations we run our the MCMC parameter estimate:
That is it! All we need to do is to run our code:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of iterations</span></span>
<span id="cb3-2"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-2" aria-hidden="true" tabindex="-1"></a>phos_iter <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb3-3"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the mcmc estimate</span></span>
<span id="cb3-5"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-5" aria-hidden="true" tabindex="-1"></a>phos_mcmc <span class="ot">&lt;-</span> <span class="fu">mcmc_estimate</span>(<span class="at">model =</span> phos_model,</span>
<span id="cb3-6"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> phosphorous,</span>
<span id="cb3-7"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-7" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">parameters =</span> phos_param,</span>
<span id="cb3-8"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">iterations =</span> phos_iter</span>
<span id="cb3-9"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb3-9" aria-hidden="true" tabindex="-1"></a>                                  )</span></code></pre></div>
<p>The function <code>mcmc_estimate</code> may take some time (which is OK). This function has several inputs, which for convenience we write them on separate lines.</p>
<p>Let’s take a look at the data frame <code>phosphorous_mcmc</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(phos_mcmc)</span></code></pre></div>
<pre><code>## Rows: 1,000
## Columns: 4
## $ accept_flag &lt;lgl&gt; TRUE, TRUE, TRUE, FALSE, TRUE, FALSE, TRUE, TRUE, FALSE, F…
## $ l_hood      &lt;dbl&gt; -4.448511, -4.978073, -4.675442, -4.675442, -4.549668, -4.…
## $ c           &lt;dbl&gt; 1.535446, 1.535446, 1.535446, 1.535446, 1.535446, 1.535446…
## $ theta       &lt;dbl&gt; 15.519783, 12.377643, 10.705013, 10.705013, 10.453346, 10.…</code></pre>
<p>There are four columns here:
- <code>accept_flag</code> tells you if at that particular iteration the MCMC estimate was accepted or not.
- <code>l_hood</code> is the value of the likelihood for that given iteration.
- The values of the parameters follow on the next few lines.</p>
<p>Next we need to visualize our results. The function <code>mcmc_visualize</code> summarizes and visualizes the results filtering on whenever <code>accept_flag</code> is <code>TRUE</code> (which means the parameter was accepted).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the results</span></span>
<span id="cb6-2"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_visualize</span>(<span class="at">model =</span> phos_model,</span>
<span id="cb6-3"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb6-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> phosphorous,</span>
<span id="cb6-4"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb6-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">mcmc_out =</span> phos_mcmc</span>
<span id="cb6-5"><a href="mcmc-parameter-estimation-with-an-empirical-model.html#cb6-5" aria-hidden="true" tabindex="-1"></a>               )</span></code></pre></div>
<p>You will notice that <code>mcmc_visualize</code> produces different types of graphs. Let’s take a look at each one individually. The first plot is called a pairwise parameter plot. This contains a lot of different plots together, in a matrix pattern:</p>
<div class="figure"><span id="fig:phos-pp-13"></span>
<img src="figures/13-mcmc/histogram.png" alt="Pairwise parameter histogram for the `phosphorous` data set." width="2in" />
<p class="caption">
Figure 2.1: Pairwise parameter histogram for the <code>phosphorous</code> data set.
</p>
</div>
<p>Along of the diagonal of Figure <a href="mcmc-parameter-estimation-with-an-empirical-model.html#fig:phos-pp-13">2.1</a> is a histogram of the accepted parameter values from the Metropolis algorithm. Depending on the results that you obtain, you may have some interesting shaped histograms. Generally they are grouped in the following ways:</p>
<ul>
<li><em>well-constrained:</em> the parameter takes on a definite, well-defined value.</li>
<li><em>edge-hitting:</em> the parameter seems to cluster near the edges of its value. The parameter <span class="math inline">\(b\)</span> seems to behave like this.</li>
<li><em>non-informative:</em> the histogram looks like a uniform distribution.</li>
</ul>
<p>The off-diagonal terms in Figure <a href="mcmc-parameter-estimation-with-an-empirical-model.html#fig:phos-pp-13">2.1</a> are interesting as well. The lower off-diagonal makes a scatter plot of the accepted values for the two parameters in the particular row and column, and the upper off-diagonal reports the correlation coefficient <span class="math inline">\(r\)</span> of the variables in that particular row and column. This helps ascertain the degree of <em>equifinality</em> in a particular set of variables. In the Figure <a href="mcmc-parameter-estimation-with-an-empirical-model.html#fig:phos-pp-13">2.1</a> it looks like <em>c</em> increases, <span class="math inline">\(\theta\)</span> decreases. This degree of linear coupling means that we may not be able to independent resolve each parameter separately. This is ok, just that we need to be aware of these relationships. Perhaps we may be able to go out in the field and measure a parameter more carefully, narrowing the range of accepted values.</p>
<p>Figure <a href="mcmc-parameter-estimation-with-an-empirical-model.html#fig:phos-out-13">2.2</a> displays an <em>ensemble</em> estimate of the results with the data. The ensemble average plot provides a high-level model-data overview. The black line represents the median ensemble average, and the grey is the 95% confidence interval, giving you a perspective of the model spread with the data. For our results here it does look there is wide variation in the model, most likely due to the relative wide confidence intervals on our parameters.</p>
<div class="figure"><span id="fig:phos-out-13"></span>
<img src="figures/13-mcmc/output-plot.png" alt="Ensemble output results from the MCMC parameter estimation." width="2in" />
<p class="caption">
Figure 2.2: Ensemble output results from the MCMC parameter estimation.
</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mcmc.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mcmc-parameter-estimation-with-a-differential-equation-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jules32/bookdown-tutorial/edit/master/13-mcmc.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://jmzobitz.github.io/ModelingWithR/13-mcmc.Rmd",
"text": null
},
"download": {},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
